<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Watch Ads App</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            background-color: #0088cc;
            color: white;
            border: none;
            border-radius: 5px;
            margin: 5px;
        }
        button:hover {
            background-color: #006bb3;
        }
        #adContainer {
            margin-top: 20px;
            width: 100%;
            text-align: center;
        }
    </style>
    <!-- AdExtra SDK Script from Dashboard (ID 688) -->
    <script async src="https://partner.adextra.io/jt/ec47ce5f549a1da793061abb691bfc6da41409a4.js" id="adextra-sdk"></script>
    <!-- Monetag SDK Script -->
    <script src='//libtl.com/sdk.js' data-zone='10033027' data-sdk='show_10033027'></script>
</head>
<body>
    <h1>Watch Ads to Earn Rewards</h1>
    <!-- AdExtra Button -->
    <button onclick="showAdExtraAd()">Watch AdExtra Ads</button>
    <!-- Monetag Button -->
    <button onclick="showMonetagAd()">Watch Monetag Ads</button>
    <div id="ec47ce5f549a1da793061abb691bfc6da41409a4" style="width: 100%; height: 0;"></div>
    <div id="monetag-ad-container" style="width: 100%; height: 0; margin-top: 10px;"></div>

    <script>
        // Telegram Web App Initialization
        window.Telegram.WebApp.ready();
        window.Telegram.WebApp.expand();
        console.log("Telegram WebApp initialized");

        // Wait for AdExtra script to load before init
        const adextraScript = document.getElementById('adextra-sdk');
        adextraScript.addEventListener('load', function() {
            console.log('AdExtra SDK script loaded successfully');
            // AdExtra Initialization
            window.AdExtra = window.AdExtra || [];
            AdExtra.init({
                appId: '688', // Energy Reward ID from dashboard
                adUnitId: 'ec47ce5f549a1da793061abb691bfc6da41409a4',
                onAdLoaded: function() {
                    console.log('AdExtra ad loaded successfully!');
                },
                onAdError: function(error) {
                    console.error('AdExtra ad error:', error);
                    alert('AdExtra Error: ' + error);
                }
            });
        });
        adextraScript.addEventListener('error', function() {
            console.error('AdExtra SDK script failed to load');
            alert('AdExtra SDK script failed to load. Check network or dashboard for new script.');
        });

        // Function to show AdExtra ad on button click
        function showAdExtraAd() {
            console.log("Button clicked, attempting to show AdExtra ad...");
            if (window.AdExtra && typeof AdExtra.showAd === 'function') {
                AdExtra.showAd('ec47ce5f549a1da793061abb691bfc6da41409a4', {
                    type: 'rewarded_video',
                    rewardCallback: function(reward) {
                        alert('AdExtra Reward earned: ' + reward + ' points!');
                    },
                    onClose: function() {
                        console.log('AdExtra ad closed by user');
                    }
                });
            } else {
                console.error('AdExtra SDK not loaded or showAd function not available');
                alert('AdExtra SDK not loaded. Check console for details.');
            }
        }

        // Function to show Monetag ad on button click
        function showMonetagAd() {
            console.log("Button clicked, attempting to show Monetag ad...");
            if (typeof window.show_10033027 === 'function') {
                show_10033027({
                    type: 'end',
                    ymid: 'user-' + Math.random().toString(36).slice(2),
                    requestVar: 'watch_ads_button',
                    catchIfNoFeed: true
                })
                .then((result) => {
                    console.log('Monetag ad success:', result);
                    if (result.reward_event_type === 'valued') {
                        alert('Monetag Reward earned: ' + (result.estimated_price || 5) + ' points!');
                    } else {
                        alert('Monetag ad viewed but no reward.');
                    }
                })
                .catch((error) => {
                    console.error('Monetag ad error:', error.message);
                    alert('Monetag ad failed: ' + error.message);
                });
            } else {
                console.error('Monetag SDK not loaded or show_10033027 function not available');
                alert('Monetag SDK not loaded.');
            }
        }

        // Load ads when page loads
        window.addEventListener('load', function() {
            console.log("Page loaded, initializing ads...");
            if (window.AdExtra && typeof AdExtra.loadAd === 'function') {
                AdExtra.loadAd('ec47ce5f549a1da793061abb691bfc6da41409a4');
            }
            if (typeof window.show_10033027 === 'function') {
                show_10033027({ type: 'preload', timeout: 5 })
                    .then(() => console.log('Monetag preloaded'))
                    .catch(() => console.error('Monetag preload failed'));
            }
        });
    </script>
</body>
</html>
