<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin Panel</title>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>

  <!-- Chart.js for graphs -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    :root {
      --primary: #6200ea;
      --secondary: #03dac5;
      --light: #ffffff;
      --dark: #121212;
      --card-bg: #1f1f1f;
      --text-color: #ffffff;
      --ad-bg: #222;
      --ad-item-bg: #333;
      --border-color: #444;
      --danger: #dc3545;
      --success: #28a745;
      --info: #17a2b8;
      --h3-color: var(--text-color);
    }

    body.light-mode {
      --dark: #ffffff;
      --card-bg: #ffffff;
      --text-color: #000000;
      --ad-bg: #f9f9f9;
      --ad-item-bg: #f1f1f1;
      --border-color: #dddddd;
      background: #ffffff !important;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, sans-serif;
    }

    body {
      background: linear-gradient(135deg, var(--dark), #1a1a2e);
      color: var(--text-color);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      transition: all 0.4s ease;
      padding: 20px;
      text-align: center;
    }

    .container {
      width: 100%;
      max-width: 800px;
      background: var(--card-bg);
      border-radius: 20px;
      overflow: hidden;
      padding: 30px;
      transition: all 0.4s ease;
      position: relative;
    }

    h1 {
      font-size: 36px;
      color: var(--primary);
      margin-bottom: 30px;
      text-align: center;
    }

    .card {
      background: var(--ad-item-bg);
      padding: 25px;
      border-radius: 15px;
      margin-bottom: 25px;
      border: 1px solid var(--border-color);
      text-align: left;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }

    .card h2 {
      color: var(--secondary);
      margin-bottom: 15px;
      font-size: 26px;
      border-bottom: 2px solid var(--primary);
      padding-bottom: 10px;
    }
    
    .card h3 {
        color: var(--h3-color);
        margin-bottom: 10px;
        font-size: 20px;
    }

    .stat-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); 
      gap: 10px; 
      margin-bottom: 20px;
    }

    .stat-item {
      background: var(--card-bg);
      padding: 10px; 
      border-radius: 10px;
      border: 1px solid var(--border-color);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-size: 13px; 
      min-height: 70px; 
      text-align: center; 
      word-break: break-word; 
    }

    .stat-item span {
      font-size: 26px; 
      font-weight: bold;
      color: var(--secondary);
      margin-top: 5px;
    }

    .input-with-button {
        display: flex;
        align-items: center;
        width: 100%;
        margin-top: 5px;
        margin-bottom: 5px;
    }

    .card input[type="text"], .card input[type="password"], .card select, .card input[type="number"] {
      flex-grow: 1;
      padding: 12px;
      border-radius: 8px;
      border: 1px solid var(--border-color);
      background: var(--card-bg);
      color: var(--text-color);
      font-size: 16px;
      margin-right: 0px; 
    }

    .card input[type="text"]:last-child {
        margin-right: 0; 
    }

    .btn {
      background: var(--secondary);
      color: #000;
      border: none;
      border-radius: 8px;
      padding: 12px 25px;
      cursor: pointer;
      font-weight: 600;
      margin-right: 0px; 
      transition: background 0.2s ease, transform 0.2s ease;
      font-size: 16px;
    }

    .btn-primary {
      background: var(--primary);
      color: #fff;
      margin-top: 10px;
    }
    .btn-success {
        background: var(--success);
        color: #fff;
    }

    .btn:hover {
      opacity: 0.9;
      transform: translateY(-2px);
    }

    .btn-danger {
      background: var(--danger);
      color: #fff;
    }

    #login-container {
      text-align: center;
      padding: 50px 20px;
    }

    #login-container input {
        display: block;
        margin: 10px auto;
        width: 80%;
        max-width: 300px;
        padding: 14px;
        border-radius: 8px;
        border: 1px solid var(--border-color);
        background: var(--card-bg);
        color: var(--text-color);
        font-size: 17px;
    }

    #login-button {
      background: var(--primary);
      color: #fff;
      padding: 14px 30px;
      border-radius: 10px;
      font-size: 19px;
      font-weight: bold;
      cursor: pointer;
      border: none;
      transition: background 0.2s ease;
      margin-top: 20px;
    }

    #login-button:hover {
      filter: brightness(1.2);
    }

    /* Initially hide everything except loading, or login based on JS */
    #admin-content, #login-container {
      display: none;
    }
    
    #loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1001;
        color: var(--light);
        font-size: 24px;
        flex-direction: column;
    }

    .spinner {
        border: 8px solid rgba(255, 255, 255, 0.3);
        border-top: 8px solid var(--primary);
        border-radius: 50%;
        width: 60px;
        height: 60px;
        animation: spin 1s linear infinite;
        margin-bottom: 20px;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }


    #mode-toggle {
      position: absolute;
      top: 15px;
      right: 30px; 
      padding: 5px; 
      background: transparent; 
      color: var(--primary); 
      border: none; 
      border-radius: 100px;
      cursor: pointer;
      font-size: 18px; 
      transition: all 0.3s ease;
      z-index: 1100;
      display: none; 
    }
    #mode-toggle:hover {
      background-color: rgba(98, 0, 234, 0.1); 
    }

    .ad-notification {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.9);
      color: var(--light);
      padding: 20px 40px;
      border-radius: 12px;
      z-index: 1000;
      display: none;
      font-size: 18px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.5);
    }

    .monthly-list-item {
        display: flex;
        justify-content: space-between;
        padding: 10px 5px;
        border-bottom: 1px dashed var(--border-color);
        cursor: pointer;
        transition: background-color 0.2s ease;
    }
    .monthly-list-item:hover {
        background-color: rgba(3, 218, 197, 0.05);
    }
    .monthly-list-item:last-child {
        border-bottom: none;
    }
    .monthly-list-item span {
        font-weight: 500;
        font-size: 15px;
    }
    .monthly-list-item.selected {
        background-color: rgba(3, 218, 197, 0.15);
        border-radius: 5px;
        padding: 10px;
    }
    #daily-stats-list, #monthly-stats-list {
        max-height: 250px;
        overflow-y: auto;
        border: 1px solid var(--border-color);
        border-radius: 10px;
        padding: 10px;
        background-color: var(--card-bg);
    }
    #daily-stats-list .daily-item {
        display: flex;
        justify-content: space-between;
        padding: 8px 0;
        border-bottom: 1px dotted var(--border-color);
    }
    #daily-stats-list .daily-item:last-child {
        border-bottom: none;
    }
    #daily-stats-list .daily-item span {
        font-size: 15px;
    }

    .monthly-daily-flex {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
    }

    /* --- CHART CONTAINER STYLES --- */
    .chart-container {
      position: relative;
      width: 100%;
      height: 300px;
      margin-top: 15px;
    }
    .chart-container canvas {
      max-width: 100%;
      height: 100% !important;
      width: 100% !important;
    }

    /* Override Chart.js default font color for dark mode */
    body:not(.light-mode) .chartjs-render-monitor,
    body:not(.light-mode) .chartjs-render-monitor canvas {
        color: var(--text-color) !important; 
    }

    /* Ad pattern buttons specific styles */
    .ad-pattern-buttons {
        display: flex;
        flex-direction: column;
        gap: 10px;
        margin-top: 15px;
    }
    .ad-pattern-buttons button {
        background-color: #555;
        color: white;
        padding: 10px 15px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 16px;
        transition: background-color 0.2s ease;
    }
    .ad-pattern-buttons button.active {
        background-color: var(--primary);
    }
    .ad-pattern-buttons button:hover:not(.active) {
        background-color: #777;
    }
    .ad-step-control {
        margin-top: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
        flex-wrap: wrap; /* Added for responsiveness */
    }
    .ad-step-control label {
        font-weight: bold;
    }
    .ad-step-control input {
        width: 80px;
        text-align: center;
    }
    .ad-step-control .btn {
        margin-left: auto; /* Pushes the button to the right */
    }
    /* Adexium Toggle specific style */
    .adexium-toggle-container {
        display: flex;
        align-items: center;
        margin-left: 20px; /* Space from steps control */
        gap: 10px;
    }
    .switch {
      position: relative;
      display: inline-block;
      width: 45px;
      height: 25px;
    }
    .switch input { 
      opacity: 0;
      width: 0;
      height: 0;
    }
    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      transition: .4s;
      border-radius: 25px;
    }
    .slider:before {
      position: absolute;
      content: "";
      height: 17px;
      width: 17px;
      left: 4px;
      bottom: 4px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }
    input:checked + .slider {
      background-color: var(--primary);
    }
    input:focus + .slider {
      box-shadow: 0 0 1px var(--primary);
    }
    input:checked + .slider:before {
      transform: translateX(20px);
    }


    /* --- Responsive Adjustments --- */
    @media (max-width: 768px) {
      body {
        padding: 15px;
      }

      .container {
        padding: 20px;
        border-radius: 15px;
      }

      h1 {
        font-size: 30px;
        margin-bottom: 25px;
      }

      .card {
        padding: 20px;
        border-radius: 12px;
        margin-bottom: 20px;
      }

      .card h2 {
        font-size: 22px;
        margin-bottom: 12px;
        padding-bottom: 8px;
      }
      
      .card h3 {
        font-size: 18px;
      }

      .stat-grid {
        grid-template-columns: repeat(auto-fit, minmax(80px, 1fr)); 
        gap: 5px; 
      }
      
      .stat-item {
        padding: 8px; 
        font-size: 11px; 
        min-height: 60px; 
      }

      .stat-item span {
        font-size: 22px; 
      }

      .card input[type="text"], .card input[type="password"], .card select, .card input[type="number"] {
        width: 100%;
        padding: 10px;
        font-size: 15px;
        margin-right: 0;
      }

      .input-with-button {
        flex-direction: column;
        align-items: stretch;
      }

      .input-with-button input {
        margin-right: 0;
        margin-bottom: 0px;
      }

      .btn {
        width: 100%;
        margin-right: 0;
        margin-top: 10px;
        padding: 10px 15px;
        font-size: 15px;
      }
      
      .btn-primary + .btn {
        margin-top: 10px;
      }

      #login-container input {
        width: 90%;
        max-width: none;
        padding: 12px;
        font-size: 16px;
      }

      #login-button {
        padding: 12px 25px;
        font-size: 17px;
      }

      #mode-toggle {
        right: 20px; 
        font-size: 16px; 
        padding: 3px;
      }

      .chart-container {
        height: 200px; 
      }

      .monthly-daily-flex {
          grid-template-columns: 1fr;
          gap: 15px;
      }

      .ad-notification {
        width: 90%;
        padding: 15px 25px;
        font-size: 16px;
      }
      .ad-step-control {
        flex-direction: column;
        align-items: flex-start;
      }
      .ad-step-control input {
        width: 100%;
      }
      .ad-step-control .btn {
          margin-left: 0; /* Remove auto margin on small screens */
          width: auto; /* Allow button to size naturally */
          align-self: flex-start; /* Align button to start */
      }
      .adexium-toggle-container {
          margin-left: 0;
          margin-top: 10px; /* Add some space if stacked */
          justify-content: flex-start;
      }
    }
  </style>

</head>
<body>
  <div class="ad-notification" id="ad-notification"></div>
  <div id="loading-overlay">
    <div class="spinner"></div>
    <p>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>
  </div>
  <div class="container">
    <button id="mode-toggle" onclick="toggleMode()">üåô</button>

<div id="login-container">
  <h1>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶≤‡¶ó‡¶á‡¶®</h1>
  <input type="text" id="admin-email" placeholder="‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶á‡¶Æ‡ßá‡¶á‡¶≤" autocomplete="username">
  <input type="password" id="admin-password" placeholder="‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°" autocomplete="current-password">
  <button id="login-button" onclick="loginAdminWithEmailPassword()">‡¶≤‡¶ó‡¶á‡¶®</button>
</div>

<div id="admin-content">
  <h1>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤</h1>

  <div class="card">
    <h2>‡¶≠‡¶ø‡¶ú‡¶ø‡¶ü‡¶∞ ‡¶ì‡¶≠‡¶æ‡¶∞‡¶≠‡¶ø‡¶â</h2>
    <div class="stat-grid">
      <div class="stat-item">
        ‡¶Æ‡ßã‡¶ü ‡¶≠‡¶ø‡¶ú‡¶ø‡¶ü‡¶∞
        <span id="total-visitors">0</span>
      </div>
      <div class="stat-item">
        ‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶≠‡¶ø‡¶ú‡¶ø‡¶ü‡¶∞ (UTC)
        <span id="daily-visitors">0</span>
      </div>
    </div>
  </div>

  <div class="card">
    <h2>‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏</h2>
    <div class="ad-pattern-buttons">
        <h3>‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶®‡ßá‡¶∞ ‡¶ß‡¶∞‡¶£ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®:</h3>
        <button id="ad-pattern-1-btn" onclick="selectAdPattern(1)">‡¶™‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∞‡ßç‡¶® ‡ßß: ‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ Monetag</button>
        <button id="ad-pattern-2-btn" onclick="selectAdPattern(2)">‡¶™‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∞‡ßç‡¶® ‡ß®: Monetag ‡¶ì Gigapub</button>
        <button id="ad-pattern-3-btn" onclick="selectAdPattern(3)">‡¶™‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∞‡ßç‡¶® ‡ß©: ‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ Gigapub</button>
    </div>

    <div class="ad-step-control">
        <label for="total-ad-steps">‡¶Æ‡ßã‡¶ü ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶®‡ßá‡¶∞ ‡¶ß‡¶æ‡¶™:</label>
        <input type="number" id="total-ad-steps" min="1" max="10" value="5" onchange="updateTotalAdSteps()">
        <button class="btn btn-success" onclick="saveTotalAdSteps()">‡¶ß‡¶æ‡¶™ ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        <div class="adexium-toggle-container">
            <label>Adexium ‡¶ö‡¶æ‡¶≤‡ßÅ/‡¶¨‡¶®‡ßç‡¶ß:</label>
            <label class="switch">
              <input type="checkbox" id="adexium-toggle" onchange="toggleAdexium()">
              <span class="slider"></span>
            </label>
        </div>
    </div>
  </div>

  <div class="card">
    <h2>‡¶ï‡ßç‡¶Ø‡¶æ‡¶®‡¶≠‡¶æ ‡¶™‡ßç‡¶∞‡ßã ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï</h2>
    <p>‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶ï‡ßç‡¶Ø‡¶æ‡¶®‡¶≠‡¶æ ‡¶™‡ßç‡¶∞‡ßã ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï: <span id="current-canva-link" style="color: var(--secondary); word-break: break-all;">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</span></p>
    <label for="new-canva-link" style="display: block; margin-top: 10px; margin-bottom: 5px; font-weight: bold;">‡¶®‡¶§‡ßÅ‡¶® ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®:</label>
    <div class="input-with-button">
        <input type="text" id="new-canva-link" placeholder="https://www.canva.com/brand/join?token=..." value="">
    </div>
    <button class="btn btn-primary" onclick="updateCanvaLink()">‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button>
  </div>

  <div class="card">
    <h2>‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶ì ‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶≠‡¶ø‡¶ú‡¶ø‡¶ü‡¶∞</h2>
    <div class="chart-container">
        <canvas id="daily-monthly-visitors-chart"></canvas>
    </div>
  </div>

  <div class="card">
    <h2>‡¶≠‡¶ø‡¶ú‡¶ø‡¶ü‡¶∞ ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§</h2>
    <div class="monthly-daily-flex">
        <div style="flex: 1;">
            <h3>‡¶Æ‡¶æ‡¶∏ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®:</h3>
            <div id="monthly-stats-list">
                <p>‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>
            </div>
        </div>
        <div style="flex: 1;">
            <h3><span id="selected-month-display"></span> ‡¶è‡¶∞ ‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶≠‡¶ø‡¶ú‡¶ø‡¶ü‡¶∞:</h3>
            <div id="daily-stats-list">
                <p>‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶≠‡¶ø‡¶ú‡¶ø‡¶ü‡¶∞ ‡¶¶‡ßá‡¶ñ‡¶§‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶Æ‡¶æ‡¶∏ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p>
            </div>
        </div>
    </div>
  </div>


<button class="btn btn-danger" onclick="logoutAdmin()" style="margin-top: 20px;">‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü</button>

</div>

</div>
  <script>
    const firebaseConfig = {
        apiKey: "‡¶Ü‡¶™‡¶®‡¶æ‡¶∞_API_KEY", // ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ Firebase API Key ‡¶¶‡¶ø‡¶®
        authDomain: "‡¶Ü‡¶™‡¶®‡¶æ‡¶∞_AUTH_DOMAIN", // ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ Firebase Auth Domain ‡¶¶‡¶ø‡¶®
        databaseURL: "‡¶Ü‡¶™‡¶®‡¶æ‡¶∞_DATABASE_URL", // ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ Firebase Database URL ‡¶¶‡¶ø‡¶®
        projectId: "‡¶Ü‡¶™‡¶®‡¶æ‡¶∞_PROJECT_ID", // ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ Firebase Project ID ‡¶¶‡¶ø‡¶®
        storageBucket: "‡¶Ü‡¶™‡¶®‡¶æ‡¶∞_STORAGE_BUCKET", // ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ Firebase Storage Bucket ‡¶¶‡¶ø‡¶®
        messagingSenderId: "‡¶Ü‡¶™‡¶®‡¶æ‡¶∞_MESSAGING_SENDER_ID", // ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ Firebase Messaging Sender ID ‡¶¶‡¶ø‡¶®
        appId: "‡¶Ü‡¶™‡¶®‡¶æ‡¶∞_APP_ID" // ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ Firebase App ID ‡¶¶‡¶ø‡¶®
    };

    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    const auth = firebase.auth();

    const ADMIN_UID = "‡¶Ü‡¶™‡¶®‡¶æ‡¶∞_‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶®_UID"; // ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ Firebase ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® UID ‡¶¶‡¶ø‡¶®
    let dailyMonthlyVisitorsChart;
    let currentSelectedMonth = '';
    let isInitialAuthCheckComplete = false;

    function getTodayKeyUTC() {
        const now = new Date();
        const year = now.getUTCFullYear();
        const month = (now.getUTCMonth() + 1).toString().padStart(2, '0');
        const day = now.getUTCDate().toString().padStart(2, '0');
        return `${year}-${month}-${day}`;
    }

    function getFormattedDateUTC(year, month, day) {
        const date = new Date(Date.UTC(year, month - 1, day));
        const options = { year: 'numeric', month: 'long', day: 'numeric', timeZone: 'UTC' };
        return date.toLocaleDateString('en-US', options);
    }

    function getFormattedMonthUTC(year, month) {
        const date = new Date(Date.UTC(year, month - 1, 1));
        const options = { year: 'numeric', month: 'long', timeZone: 'UTC' };
        return date.toLocaleDateString('en-US', options);
    }

    window.addEventListener("DOMContentLoaded", () => {
        const savedMode = localStorage.getItem("themeMode");
        if (savedMode === "light") {
            document.body.classList.add("light-mode");
            document.getElementById("mode-toggle").textContent = "‚òÄÔ∏è";
        }

        showLoadingOverlay();

        auth.onAuthStateChanged((user) => {
            if (!isInitialAuthCheckComplete) {
                if (user && user.uid === ADMIN_UID) {
                    setTimeout(() => {
                        document.getElementById('login-container').style.display = 'none';
                        document.getElementById('admin-content').style.display = 'block';
                        document.getElementById('mode-toggle').style.display = 'block';
                        hideLoadingOverlay();
                        loadAdminData();
                    }, 1500);
                } else {
                    setTimeout(() => {
                        document.getElementById('login-container').style.display = 'block';
                        document.getElementById('admin-content').style.display = 'none';
                        document.getElementById('mode-toggle').style.display = 'none';
                        hideLoadingOverlay();
                    }, 1000);
                }
                isInitialAuthCheckComplete = true;
            } else {
                if (user && user.uid === ADMIN_UID) {
                    setTimeout(() => {
                        document.getElementById('login-container').style.display = 'none';
                        document.getElementById('admin-content').style.display = 'block';
                        document.getElementById('mode-toggle').style.display = 'block';
                        hideLoadingOverlay();
                        loadAdminData();
                    }, 1500);
                } else {
                    document.getElementById('admin-content').style.display = 'none';
                    document.getElementById('login-container').style.display = 'block';
                    document.getElementById('mode-toggle').style.display = 'none';
                    hideLoadingOverlay();
                }
            }
        });
    });

    function showLoadingOverlay(message = "‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...") {
        const loadingOverlay = document.getElementById('loading-overlay');
        loadingOverlay.querySelector('p').textContent = message;
        loadingOverlay.style.display = 'flex';
        document.getElementById('mode-toggle').style.display = 'none';
    }

    function hideLoadingOverlay() {
        document.getElementById('loading-overlay').style.display = 'none';
    }

    function loginAdminWithEmailPassword() {
        const email = document.getElementById('admin-email').value;
        const password = document.getElementById('admin-password').value;

        if (!email || !password) {
            showAdNotification("‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶è‡¶¨‡¶Ç ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶â‡¶≠‡¶Ø‡¶º‡¶á ‡¶™‡ßç‡¶∞‡¶¨‡ßá‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§");
            return;
        }

        showLoadingOverlay("‡¶≤‡¶ó‡¶á‡¶® ‡¶π‡¶ö‡ßç‡¶õ‡ßá...");
        document.getElementById('mode-toggle').style.display = 'none';

        auth.signInWithEmailAndPassword(email, password)
            .then((userCredential) => {
                const user = userCredential.user;
                if (user.uid === ADMIN_UID) {
                    document.getElementById('login-container').style.display = 'none';
                } else {
                    auth.signOut();
                    showAdNotification("‡¶Ü‡¶™‡¶®‡¶ø ‡¶è‡¶á ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤‡ßá ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡ßç‡¶∏‡ßá‡¶∏ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ö‡¶®‡ßÅ‡¶Æ‡ßã‡¶¶‡¶ø‡¶§ ‡¶®‡¶®‡•§");
                    hideLoadingOverlay();
                    document.getElementById('login-container').style.display = 'block';
                    document.getElementById('mode-toggle').style.display = 'none';
                }
            })
            .catch((error) => {
                console.error("‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶≤‡¶ó‡¶á‡¶® ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•:", error);
                showAdNotification("‡¶≤‡¶ó‡¶á‡¶® ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•: " + error.message);
                hideLoadingOverlay();
                document.getElementById('login-container').style.display = 'block';
                document.getElementById('mode-toggle').style.display = 'none';
            });
    }

    function logoutAdmin() {
        showLoadingOverlay("‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü ‡¶π‡¶ö‡ßç‡¶õ‡ßá...");
        document.getElementById('mode-toggle').style.display = 'none';
        auth.signOut().then(() => {
            showAdNotification("‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§");
            setTimeout(() => {
                hideLoadingOverlay();
            }, 500);
        }).catch((error) => {
            console.error("‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø:", error);
            showAdNotification("‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø: " + error.message);
            hideLoadingOverlay();
        });
    }

    function loadAdminData() {
        // ‡¶ï‡ßç‡¶Ø‡¶æ‡¶®‡¶≠‡¶æ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®
        database.ref('canvaLink').on('value', (snapshot) => {
            const link = snapshot.val();
            document.getElementById('current-canva-link').textContent = link || 'N/A';
            document.getElementById('new-canva-link').value = '';
        });

        // ‡¶≠‡¶ø‡¶ú‡¶ø‡¶ü‡¶∞ ‡¶ì‡¶≠‡¶æ‡¶∞‡¶≠‡¶ø‡¶â ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®
        database.ref('visitors/total').on('value', (snapshot) => {
            document.getElementById('total-visitors').textContent = snapshot.val() || 0;
        });

        const fullCurrentDatePath = getTodayKeyUTC();
        database.ref(`visitors/daily/${fullCurrentDatePath}`).on('value', (snapshot) => {
            document.getElementById('daily-visitors').textContent = snapshot.val() || 0;
        });

        // ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶®‡ßá‡¶∞ ‡¶ß‡¶∞‡¶£ ‡¶è‡¶¨‡¶Ç ‡¶Æ‡ßã‡¶ü ‡¶ß‡¶æ‡¶™ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®
        database.ref('adSettings').on('value', (snapshot) => {
            const settings = snapshot.val();
            const currentPattern = settings ? settings.pattern : 1; // ‡¶°‡¶ø‡¶´‡¶≤‡ßç‡¶ü ‡¶™‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∞‡ßç‡¶® 1
            const currentSteps = settings ? settings.totalSteps : 5; // ‡¶°‡¶ø‡¶´‡¶≤‡ßç‡¶ü 5 ‡¶ß‡¶æ‡¶™
            const adexiumStatus = settings ? settings.adexiumEnabled : false; // ‡¶°‡¶ø‡¶´‡¶≤‡ßç‡¶ü Adexium ‡¶¨‡¶®‡ßç‡¶ß

            // ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶®‡ßá‡¶∞ ‡¶ß‡¶∞‡¶£ ‡¶¨‡¶æ‡¶ü‡¶®‡ßá‡¶∞ UI ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®
            document.querySelectorAll('.ad-pattern-buttons button').forEach(button => {
                button.classList.remove('active');
            });
            document.getElementById(`ad-pattern-${currentPattern}-btn`).classList.add('active');

            // ‡¶Æ‡ßã‡¶ü ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶®‡ßá‡¶∞ ‡¶ß‡¶æ‡¶™‡ßá‡¶∞ UI ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®
            const totalAdStepsInput = document.getElementById('total-ad-steps');
            totalAdStepsInput.value = currentSteps;

            // Adexium ‡¶ü‡¶ó‡¶≤‡ßá‡¶∞ UI ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®
            document.getElementById('adexium-toggle').checked = adexiumStatus;
        });

        // ‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶≠‡¶ø‡¶ú‡¶ø‡¶ü‡¶∞ ‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®
        database.ref('visitors/monthly').orderByKey().on('value', (snapshot) => {
            const monthlyStatsList = document.getElementById('monthly-stats-list');
            monthlyStatsList.innerHTML = '';

            if (snapshot.exists()) {
                const data = snapshot.val();
                const months = Object.keys(data).sort((a, b) => {
                    const [yearA, monthA] = a.split('-').map(Number);
                    const [yearB, monthB] = b.split('-').map(Number);
                    if (yearA !== yearB) return yearB - yearA;
                    return monthB - monthA;
                }); 

                months.forEach(monthKey => {
                    const [year, monthNum] = monthKey.split('-');
                    const formattedMonthName = getFormattedMonthUTC(parseInt(year), parseInt(monthNum));

                    const div = document.createElement('div');
                    div.className = 'monthly-list-item';
                    div.innerHTML = `<span>${formattedMonthName}</span><span>${data
                                                                               [monthKey]} views</span>`;
                    div.onclick = () => selectMonthForDailyView(monthKey, div); 
                    monthlyStatsList.appendChild(div);
                });

                if (months.length > 0) {
                    const latestMonthKey = months[0]; 
                    const latestMonthElement = monthlyStatsList.querySelector('.monthly-list-item');
                    // Ensure the element exists before trying to select it
                    if(latestMonthElement) {
                        selectMonthForDailyView(latestMonthKey, latestMonthElement);
                    }
                }
            } else {
                monthlyStatsList.innerHTML = '<p>‡¶ï‡ßã‡¶® ‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶°‡ßá‡¶ü‡¶æ ‡¶è‡¶ñ‡¶®‡ßã ‡¶â‡¶™‡¶≤‡¶¨‡ßç‡¶ß ‡¶®‡¶Ø‡¶º‡•§</p>';
                if (dailyMonthlyVisitorsChart) {
                    dailyMonthlyVisitorsChart.destroy();
                    dailyMonthlyVisitorsChart = null;
                }
            }
        });
    }

    // --- Ad Pattern and Steps Control ---
    function selectAdPattern(patternNumber) {
        database.ref('adSettings/pattern').set(patternNumber)
            .then(() => {
                showAdNotification(`‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶®‡ßá‡¶∞ ‡¶ß‡¶∞‡¶£ ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá: ‡¶™‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∞‡ßç‡¶® ${patternNumber}‡•§`);
                // UI 'on' ‡¶≤‡¶ø‡¶∏‡ßá‡¶®‡¶æ‡¶∞ ‡¶¶‡ßç‡¶¨‡¶æ‡¶∞‡¶æ ‡¶∏‡ßç‡¶¨‡¶Ø‡¶º‡¶Ç‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡¶¨‡ßá
            })
            .catch(error => {
                console.error("‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶®‡ßá‡¶∞ ‡¶ß‡¶∞‡¶£ ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•:", error);
                showAdNotification("‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶®‡ßá‡¶∞ ‡¶ß‡¶∞‡¶£ ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶• ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§");
            });
    }

    function updateTotalAdSteps() {
        const input = document.getElementById('total-ad-steps');
        let value = parseInt(input.value);
        if (isNaN(value) || value < 1) {
            value = 1;
        } else if (value > 10) { // ‡¶Ö‡¶§‡ßç‡¶Ø‡¶ß‡¶ø‡¶ï ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶è‡¶°‡¶º‡¶æ‡¶§‡ßá ‡¶∏‡¶∞‡ßç‡¶¨‡ßã‡¶ö‡ßç‡¶ö 10 ‡¶ß‡¶æ‡¶™
            value = 10;
        }
        input.value = value;
    }

    function saveTotalAdSteps() {
        const totalSteps = parseInt(document.getElementById('total-ad-steps').value);
        database.ref('adSettings/totalSteps').set(totalSteps)
            .then(() => {
                showAdNotification(`‡¶Æ‡ßã‡¶ü ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶®‡ßá‡¶∞ ‡¶ß‡¶æ‡¶™ ${totalSteps} ‡¶è ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§`);
            })
            .catch(error => {
                console.error("‡¶Æ‡ßã‡¶ü ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶®‡ßá‡¶∞ ‡¶ß‡¶æ‡¶™ ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•:", error);
                showAdNotification("‡¶Æ‡ßã‡¶ü ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶®‡ßá‡¶∞ ‡¶ß‡¶æ‡¶™ ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶ï‡¶∞‡¶§‡ßá ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶• ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§");
            });
    }

    function toggleAdexium() {
        const adexiumToggle = document.getElementById('adexium-toggle');
        const isEnabled = adexiumToggle.checked;

        database.ref('adSettings/adexiumEnabled').set(isEnabled)
            .then(() => {
                showAdNotification(`Adexium ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ${isEnabled ? '‡¶ö‡¶æ‡¶≤‡ßÅ' : '‡¶¨‡¶®‡ßç‡¶ß'} ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§`);
            })
            .catch(error => {
                console.error("Adexium ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•:", error);
                showAdNotification("Adexium ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶• ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§");
                adexiumToggle.checked = !isEnabled; // If failed, revert UI
            });
    }

    // --- Canva Link Update ---
    function updateCanvaLink() {
        const newLinkInput = document.getElementById('new-canva-link');
        const newLink = newLinkInput.value.trim();

        if (newLink) {
            database.ref('canvaLink').set(newLink)
                .then(() => {
                    showAdNotification("‡¶ï‡ßç‡¶Ø‡¶æ‡¶®‡¶≠‡¶æ ‡¶™‡ßç‡¶∞‡ßã ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!");
                    newLinkInput.value = '';
                })
                .catch((error) => {
                    console.error("‡¶ï‡ßç‡¶Ø‡¶æ‡¶®‡¶≠‡¶æ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•:", error);
                    showAdNotification("‡¶ï‡ßç‡¶Ø‡¶æ‡¶®‡¶≠‡¶æ ‡¶™‡ßç‡¶∞‡ßã ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶• ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§");
                });
        } else {
            showAdNotification("‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶¨‡ßà‡¶ß ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶™‡ßç‡¶∞‡¶¨‡ßá‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§");
        }
    }

    // --- Utility Functions ---
    function showAdNotification(msg) {
        const el = document.getElementById('ad-notification');
        el.textContent = msg;
        el.style.display = 'block';
        setTimeout(() => {
            el.style.display = 'none';
        }, 3000);
    }

    function toggleMode() {
        const body = document.body;
        const btn = document.getElementById('mode-toggle');
        body.classList.toggle('light-mode');
        if (body.classList.contains('light-mode')) {
            btn.textContent = '‚òÄÔ∏è';
            localStorage.setItem("themeMode", "light");
        } else {
            btn.textContent = 'üåô';
            localStorage.setItem("themeMode", "dark");
        }
        document.documentElement.style.setProperty('--h3-color', document.body.classList.contains('light-mode') ? '#000000' : '#ffffff');

        if (dailyMonthlyVisitorsChart) {
            updateChartColors(dailyMonthlyVisitorsChart);
            dailyMonthlyVisitorsChart.update();
        }
    }

    // --- Chart and Visitor Details ---
    function getChartTextColor() {
        return document.body.classList.contains('light-mode') ? '#000000' : '#ffffff';
    }

    function selectMonthForDailyView(monthKey, clickedElement) {
        currentSelectedMonth = monthKey;
        const [year, monthNum] = monthKey.split('-');
        document.getElementById('selected-month-display').textContent = getFormattedMonthUTC(parseInt(year), parseInt(monthNum));

        document.querySelectorAll('.monthly-list-item').forEach(item => item.classList.remove('selected'));
        if (clickedElement) {
            clickedElement.classList.add('selected');
        }

        const dailyStatsList = document.getElementById('daily-stats-list');
        dailyStatsList.innerHTML = '<p>‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>';

        database.ref('visitors/daily/').orderByKey().startAt(monthKey + '-01').endAt(monthKey + '-31').on('value', (snapshot) => {
            dailyStatsList.innerHTML = '';
            const dayLabels = []; 
            const fullDateLabels = []; 
            const dayCounts = [];

            if (snapshot.exists()) {
                const data = snapshot.val();
                const days = Object.keys(data).filter(fullDateKey => 
                    fullDateKey.startsWith(monthKey)
                ).sort(); 
                
                days.forEach(fullDateKey => {
                    const [dayYear, dayMonth, dayDay] = fullDateKey.split('-').map(Number);
                    
                    dayLabels.push(dayDay.toString()); 
                    fullDateLabels.push(getFormattedDateUTC(dayYear, dayMonth, dayDay));
                    dayCounts.push(data[fullDateKey]);

                    const div = document.createElement('div');
                    div.className = 'daily-item';
                    div.innerHTML = `<span>${getFormattedDateUTC(dayYear, dayMonth, dayDay)}</span><span>${data[fullDateKey]} views</span>`;
                    dailyStatsList.appendChild(div);
                });

                if (dailyStatsList.children.length === 0) {
                    dailyStatsList.innerHTML = '<p>‡¶è‡¶á ‡¶Æ‡¶æ‡¶∏‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ï‡ßã‡¶® ‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶°‡ßá‡¶ü‡¶æ ‡¶â‡¶™‡¶≤‡¶¨‡ßç‡¶ß ‡¶®‡¶Ø‡¶º‡•§</p>';
                }

            } else {
                dailyStatsList.innerHTML = '<p>‡¶è‡¶á ‡¶Æ‡¶æ‡¶∏‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ï‡ßã‡¶® ‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶°‡ßá‡¶ü‡¶æ ‡¶â‡¶™‡¶≤‡¶¨‡ßç‡¶ß ‡¶®‡¶Ø‡¶º‡•§</p>';
            }

            if (dailyMonthlyVisitorsChart) {
                dailyMonthlyVisitorsChart.data.labels = dayLabels;
                dailyMonthlyVisitorsChart.data.datasets[0].data = dayCounts;
                dailyMonthlyVisitorsChart.data.datasets[0].fullDateLabels = fullDateLabels; 
                
                dailyMonthlyVisitorsChart.data.datasets[0].pointRadius = 6;
                dailyMonthlyVisitorsChart.data.datasets[0].pointHoverRadius = 8;
                dailyMonthlyVisitorsChart.data.datasets[0].pointHitRadius = 10; 

                dailyMonthlyVisitorsChart.options.plugins.title.text = `${getFormattedMonthUTC(parseInt(year), parseInt(monthNum))} ‡¶è‡¶∞ ‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶≠‡¶ø‡¶ú‡¶ø‡¶ü‡¶∞`;
                updateChartColors(dailyMonthlyVisitorsChart);
                
                dailyMonthlyVisitorsChart.options.interaction = {
                    mode: 'index', 
                    intersect: false 
                };

                dailyMonthlyVisitorsChart.update();
            } else {
                const ctx = document.getElementById('daily-monthly-visitors-chart').getContext('2d');
                dailyMonthlyVisitorsChart = new Chart(ctx, {
                    type: 'line', 
                    data: {
                        labels: dayLabels,
                        datasets: [{
                            label: '‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶≠‡¶ø‡¶ú‡¶ø‡¶ü‡¶∞',
                            data: dayCounts,
                            backgroundColor: 'rgba(3, 218, 197, 0.4)',
                            borderColor: 'rgba(3, 218, 197, 1)',
                            borderWidth: 2,
                            tension: 0.3,
                            fill: true,
                            pointRadius: 6, 
                            pointHoverRadius: 8, 
                            pointHitRadius: 10, 
                            pointBackgroundColor: 'rgba(3, 218, 197, 1)',
                            fullDateLabels: fullDateLabels 
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        
                        interaction: {
                            mode: 'index', 
                            intersect: false 
                        },

                        plugins: {
                            title: {
                                display: true,
                                text: `${getFormattedMonthUTC(parseInt(year), parseInt(monthNum))} ‡¶è‡¶∞ ‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶≠‡¶ø‡¶ú‡¶ø‡¶ü‡¶∞`,
                                color: getChartTextColor(),
                                font: {
                                    size: 18
                                }
                            },
                            legend: {
                                labels: {
                                    color: getChartTextColor()
                                }
                            },
                            tooltip: { 
                                callbacks: {
                                    title: function(tooltipItems) {
                                        const dataset = tooltipItems[0].dataset;
                                        const index = tooltipItems[0].dataIndex;
                                        return dataset.fullDateLabels[index];
                                    },
                                    label: function(tooltipItem) {
                                        return `‡¶≠‡¶ø‡¶ú‡¶ø‡¶ü‡¶∞: ${tooltipItem.raw}`;
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    color: getChartTextColor(),
                                    precision: 0 
                                },
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.1)'
                                }
                            },
                            x: {
                                ticks: {
                                    color: getChartTextColor()
                                },
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.1)'
                                }
                            }
                        }
                    }
                });
            }
        });
    }

    function updateChartColors(chart) {
        const textColor = getChartTextColor();
        chart.options.scales.x.ticks.color = textColor;
        chart.options.scales.y.ticks.color = textColor;
        chart.options.plugins.title.color = textColor;
        if (chart.options.plugins.legend) {
            chart.options.plugins.legend.labels.color = textColor;
        }
        const gridColor = document.body.classList.contains('light-mode') ? 'rgba(0, 0, 0, 0.1)' : 'rgba(255, 255, 255, 0.1)';
        chart.options.scales.x.grid.color = gridColor;
        chart.options.scales.y.grid.color = gridColor;
    }

    // Initialize h3 color based on current mode on load
    window.addEventListener('load', () => {
        document.documentElement.style.setProperty('--h3-color', document.body.classList.contains('light-mode') ? '#000000' : '#ffffff');
    });
</script>
</body>
</html>
   
