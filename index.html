<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Watch Ads App</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh; /* Use min-height for better mobile responsiveness */
            margin: 0;
            background-color: #e6f2ff; /* Light blue background */
            color: #333;
        }
        h1 {
            color: #0056b3;
            margin-bottom: 30px;
        }
        button {
            padding: 12px 25px;
            font-size: 17px;
            font-weight: bold;
            cursor: pointer;
            background-color: #0088cc; /* Telegram blue */
            color: white;
            border: none;
            border-radius: 8px;
            margin: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            transition: background-color 0.3s ease, transform 0.2s ease;
        }
        button:hover {
            background-color: #006bb3;
            transform: translateY(-2px);
        }
        button:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        .ad-message {
            margin-top: 20px;
            font-style: italic;
            color: #666;
            text-align: center;
        }
        /* Style for the ad containers - they might be initially hidden or zero height */
        #adextra-ad-container, #monetag-ad-container {
            margin-top: 15px;
            width: 100%; /* Take full width */
            text-align: center;
            /* Consider adding a min-height if you expect banner ads here */
            /* min-height: 50px; */
        }
    </style>
    <!-- Telegram Web App SDK (always include if building for TWA) -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <!-- AdExtra SDK Script from Dashboard -->
    <!-- Make sure this URL is the CURRENT one from your AdExtra dashboard for appId 688 -->
    <script async src="https://partner.adextra.io/jt/822f4e2f9ae1103c516991854e90b0f69ebae9fb.js" id="adextra-sdk"></script>

    <!-- Monetag SDK Script -->
    <!-- Make sure data-zone is correct for your Monetag setup -->
    <script src='//libtl.com/sdk.js' data-zone='10033027' data-sdk='show_10033027'></script>
</head>
<body>
    <h1>Watch Ads to Earn Rewards</h1>

    <!-- AdExtra Button -->
    <button onclick="showAdExtraAd()">Watch AdExtra Ads</button>
    <!-- Monetag Button -->
    <button onclick="showMonetagAd()">Watch Monetag Ads</button>

    <p class="ad-message">
        (Ads will appear in a new window/overlay or reward will be credited directly.)
    </p>

    <!-- AdExtra Ad Container -->
    <!-- This div is where AdExtra might render banners or take control for rewarded videos -->
    <div id="822f4e2f9ae1103c516991854e90b0f69ebae9fb" class="adextra-ad-container"></div>
    
    <!-- Monetag Ad Container (if Monetag uses one, though often it's overlays) -->
    <div id="monetag-ad-container"></div>

    <script>
        // Telegram Web App Initialization
        if (window.Telegram && window.Telegram.WebApp) {
            window.Telegram.WebApp.ready();
            window.Telegram.WebApp.expand();
            console.log("Telegram WebApp initialized and expanded.");
            // You can send a message back to Telegram if needed, e.g.:
            // window.Telegram.WebApp.sendData(JSON.stringify({ status: 'ready' }));
        } else {
            console.warn("Telegram WebApp object not found. Running in a regular browser environment.");
        }

        // --- AdExtra SDK Logic ---
        const adextraScript = document.getElementById('adextra-sdk');

        adextraScript.addEventListener('load', function() {
            console.log('AdExtra SDK script loaded successfully.');
            window.AdExtra = window.AdExtra || [];
            AdExtra.init({
                appId: '688', // Ensure this matches your AdExtra dashboard
                adUnitId: '822f4e2f9ae1103c516991854e90b0f69ebae9fb', // Ensure this matches your AdExtra dashboard
                onAdLoaded: function() {
                    console.log('AdExtra ad unit loaded (ready to show)!');
                    // Optionally enable the button here if you want it enabled only when ads are ready
                },
                onAdError: function(error) {
                    console.error('AdExtra ad initialization error:', error);
                    alert('AdExtra Error during init: ' + error);
                },
                // Additional callbacks for rewarded videos
                onReward: function(reward) {
                    console.log('AdExtra Reward earned:', reward);
                    window.Telegram.WebApp.showPopup({
                        title: 'Reward Earned!',
                        message: `You earned ${reward} points from AdExtra!`,
                        buttons: [{id: 'ok', type: 'ok'}],
                    });
                    // Here you would typically update user's balance in your backend
                },
                onClose: function() {
                    console.log('AdExtra ad closed.');
                }
            });
            // Attempt to load the ad immediately after init
            if (window.AdExtra && typeof AdExtra.loadAd === 'function') {
                AdExtra.loadAd('822f4e2f9ae1103c516991854e90b0f69ebae9fb');
            }
        });

        adextraScript.addEventListener('error', function() {
            console.error('AdExtra SDK script failed to load. Check URL or network.');
            alert('AdExtra SDK script failed to load. Please check your network and the script URL.');
        });

        function showAdExtraAd() {
            console.log("Attempting to show AdExtra ad...");
            if (window.AdExtra && typeof AdExtra.showAd === 'function') {
                AdExtra.showAd('822f4e2f9ae1103c516991854e90b0f69ebae9fb', {
                    type: 'rewarded_video', // Make sure this matches your ad unit type
                    // rewardCallback and onClose are handled by the init function's callbacks
                });
            } else {
                console.error('AdExtra SDK not fully loaded or initialized. Cannot show ad.');
                alert('AdExtra is not ready. Please check console for errors.');
                // Try to reload or re-init if you suspect a temporary issue
                if (adextraScript.src) { // Check if script src is defined to avoid errors
                    const currentSrc = adextraScript.src;
                    adextraScript.remove(); // Remove old script
                    const newScript = document.createElement('script');
                    newScript.id = 'adextra-sdk';
                    newScript.async = true;
                    newScript.src = currentSrc;
                    document.head.appendChild(newScript); // Add new script to re-trigger load
                    console.log('Attempting to reload AdExtra SDK...');
                }
            }
        }

        // --- Monetag SDK Logic ---
        // The Monetag SDK usually creates a global function (e.g., show_10033027) upon loading.
        // We can check for its existence to confirm loading.
        window.addEventListener('load', function() {
            // Give Monetag a moment to process, as it's not strictly tied to a specific script ID like AdExtra
            setTimeout(() => {
                if (typeof window.show_10033027 === 'function') {
                    console.log('Monetag SDK detected and show_10033027 function is available.');
                    // Preload Monetag ads
                    show_10033027({ type: 'preload', timeout: 5 })
                        .then(() => console.log('Monetag preloaded successfully.'))
                        .catch(error => console.error('Monetag preload failed:', error.message));
                } else {
                    console.error('Monetag SDK (show_10033027 function) not found after page load. Check script src or zone ID.');
                    alert('Monetag SDK not loaded. Check console for details.');
                }
            }, 1000); // Give it a short delay
        });

        function showMonetagAd() {
            console.log("Attempting to show Monetag ad...");
            if (typeof window.show_10033027 === 'function') {
                show_10033027({
                    type: 'end', // Often used for rewarded/interstitial types
                    ymid: 'user-' + Math.random().toString(36).slice(2), // Unique user ID
                    requestVar: 'watch_ads_button', // Custom variable for reporting
                    catchIfNoFeed: true // Try to show something even if main feed is empty
                })
                .then((result) => {
                    console.log('Monetag ad operation success:', result);
                    if (result && result.reward_event_type === 'valued') {
                        const rewardPoints = result.estimated_price || 5; // Default if price not given
                        window.Telegram.WebApp.showPopup({
                            title: 'Reward Earned!',
                            message: `You earned ${rewardPoints} points from Monetag!`,
                            buttons: [{id: 'ok', type: 'ok'}],
                        });
                        // Here you would update user's balance in your backend
                    } else {
                        window.Telegram.WebApp.showAlert('Monetag ad viewed, but no specific reward was triggered or reported.');
                    }
                })
                .catch((error) => {
                    console.error('Monetag ad operation failed:', error.message);
                    alert('Monetag ad failed: ' + error.message);
                });
            } else {
                console.error('Monetag SDK (show_10033027 function) not available. Cannot show ad.');
                alert('Monetag SDK not ready. Check console for errors.');
            }
        }
    </script>
</body>
</html>
